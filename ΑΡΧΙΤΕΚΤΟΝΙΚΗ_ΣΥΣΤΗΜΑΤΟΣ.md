# Αρχιτεκτονική Συστήματος - Pet Adoption System

## 1. Επισκόπηση Αρχιτεκτονικής

Το Pet Adoption System ακολουθεί την **Microservices Architecture** με containerization μέσω Docker και orchestration μέσω Kubernetes. Το σύστημα αποτελείται από πολλαπλά, αποσυνδεδεμένα services που επικοινωνούν μέσω REST APIs, message queues, και shared databases.

## 2. System Architecture Diagram

```
┌─────────────────────────────────────────────────────────────────────────┐
│                           CLIENT LAYER                                  │
│  ┌──────────────────────────────────────────────────────────────────┐   │
│  │                    Web Browser                                   │   │
│  │              (http://localhost:8083)                             │   │
│  └──────────────────────────────────────────────────────────────────┘   │
└─────────────────────────────────────────────────────────────────────────┘
                                    │
                                    │ HTTP/HTTPS
                                    │
┌─────────────────────────────────────────────────────────────────────────┐
│                        APPLICATION LAYER                                │
│  ┌──────────────────────┐         ┌──────────────────────┐              │
│  │   Frontend (Vue.js)  │───────▶│  Backend (Spring)     │             │
│  │   Port: 8083         │  REST   │  Port: 8080          │              │
│  │   - Vue 3            │  API    │  - Spring Boot 3     │              │
│  │   - Pinia            │         │  - Spring Security   │              │
│  │   - Vue Router       │         │  - JWT Auth          │              │
│  └──────────────────────┘         └──────────────────────┘              │
│                                           │                             │
│                                           │                             │
└───────────────────────────────────────────┼─────────────────────────────┘
                                            │
                    ┌───────────────────────┼───────────────────────┐
                    │                       │                       │
┌───────────────────▼──────┐  ┌─────────────▼──────┐  ┌─────────────▼──────┐
│   Identity Provider      │  │   Message Broker   │  │   Object Storage   │
│   Keycloak               │  │   RabbitMQ         │  │   MinIO            │
│   Port: 8081             │  │   Port: 5672/15672 │  │   Port: 9000/9001  │
│   - OAuth2/OIDC          │  │   - AMQP           │  │   - S3-compatible  │
│   - JWT Tokens           │  │   - Management UI  │  │   - Presigned URLs │
└──────────────────────────┘  └────────────────────┘  └────────────────────┘
                    │                       │                       │
┌───────────────────▼─────────────────────────────────────────────────────┐
│                           DATA LAYER                                    │
│  ┌──────────────────────┐         ┌──────────────────────┐              │
│  │   PostgreSQL (Main)  │         │   PostgreSQL (TB)    │              │
│  │   Port: 5432         │         │   Port: 5432         │              │
│  │   - Users            │         │   - ThingsBoard DB   │              │
│  │   - Animals          │         │                      │              │
│  │   - Requests         │         │                      │              │
│  │   - Keycloak         │         │                      │              │
│  └──────────────────────┘         └──────────────────────┘              │
└─────────────────────────────────────────────────────────────────────────┘
                                            │
┌───────────────────────────────────────────▼──────────────────────────────┐
│                        INTEGRATION LAYER                                 │
│  ┌──────────────────────┐         ┌──────────────────────┐               │
│  │   IoT Platform       │         │   Automation         │               │
│  │   ThingsBoard        │         │   Node-RED           │               │
│  │   Port: 9090         │         │   Port: 1880         │               │
│  │   - Telemetry        │         │   - Flow Automation  │               │
│  │   - Dashboards       │         │   - RabbitMQ Conn    │               │
│  └──────────────────────┘         └──────────────────────┘               │
│                                                                          │
│  ┌──────────────────────┐                                                │
│  │   Email Service      │                                                │
│  │   SMTP (Gmail)       │                                                │
│  │   - Verification     │                                                │
│  │   - Notifications    │                                                │
│  └──────────────────────┘                                                │
└──────────────────────────────────────────────────────────────────────────┘
```

## 3. Component Architecture

### 3.1 Frontend Components

```
┌─────────────────────────────────────────────────────────────┐
│                      Frontend Application                   │
│  ┌───────────────────────────────────────────────────────┐  │
│  │                    Vue Router                         │  │
│  │  /login  /register  /animals  /requests  /admin  ...  │  │
│  └───────────────────────────────────────────────────────┘  │
│                          │                                  │
│  ┌───────────────────────┼────────────────────────────────┐ │
│  │                       │                                │ │
│  │  ┌─────────────────┐  │ ┌──────────────────────────┐   │ │
│  │  │  Pinia Stores   │  │  │   Vue Components        │   │ │
│  │  │  - auth.js      │  │  │   - Login.vue           │   │ │
│  │  │  - application  │  │  │   - Register.vue        │   │ │
│  │  └─────────────────┘  │  │   - Animals.vue         │   │ │
│  │                       │  │   - Requests.vue        │   │ │
│  │                       │  │   - Admin.vue           │   │ │
│  │                       │  │   - Doctor.vue          │   │ │
│  │                       │  │   - Shelter.vue         │   │ │
│  │                       │  │   - Citizen.vue         │   │ │
│  │                       │  └─────────────────────────┘   │ │
│  │                       │                                │ │
│  │  ┌─────────────────┐  │  ┌─────────────────────────┐   │ │
│  │  │  Reusable       │  │  │   API Client (axios)     │  │ │
│  │  │  Components     │  │  │   - Interceptors         │  │ │
│  │  │  - Navbar.vue   │  │  │   - JWT Injection        │  │ │
│  │  │  - AnimalList   │  │  │   - Error Handling       │  │ │
│  │  │  - UserForm     │  │  └──────────────────────────┘  │ │
│  │  └─────────────────┘  │                                │ │
│  └───────────────────────┼────────────────────────────────┘ │
│                          │                                  │
└──────────────────────────┼──────────────────────────────────┘
                           │
                           │ REST API
                           │
┌──────────────────────────▼────────────────────────────────────┐
│                    Backend API (Spring Boot)                  │
└───────────────────────────────────────────────────────────────┘
```

### 3.2 Backend Components

```
┌───────────────────────────────────────────────────────────────────┐
│                    Spring Boot Application                        │
│  ┌──────────────────────────────────────────────────────────────┐ │
│  │                    Controllers Layer                         │ │
│  │  ┌──────────────┐  ┌────────────────┐  ┌───────────────────┐ │ │
│  │  │AuthController│  │AnimalController│  │RequestController  │ │ │
│  │  │ - /register  │  │ - /animals     │  │ - /requests       │ │ │
│  │  │ - /login     │  │ - CRUD ops     │  │ - approvals       │ │ │
│  │  │ - /verify    │  │ - upload       │  │                   │ │ │
│  │  └──────────────┘  └────────────────┘  └───────────────────┘ │ │
│  │                                                              │ │
│  │  ┌──────────────┐  ┌──────────────┐  ┌──────────────┐        │ │
│  │  │UserController│  │FileUploadCtrl│  │AdoptionCtrl  │        │ │
│  │  │ - /users     │  │ - /upload    │  │ - /adopt     │        │ │
│  │  │ - /roles     │  │ - /images    │  │              │        │ │
│  │  └──────────────┘  └──────────────┘  └──────────────┘        │ │
│  └──────────────────────────────────────────────────────────────┘ │
│                          │                                        │
│  ┌───────────────────────┼────────────────────────────────────┐   │
│  │                    Services Layer                          │   │
│  │  ┌──────────────┐  ┌──────────────┐  ┌───────────────┐     │   │
│  │  │ UserService  │  │AnimalService │  │RequestService │     │   │  
│  │  │ - saveUser   │  │ - saveAnimal │  │ - saveRequest │     │   │
│  │  │ - findByUser │  │ - getAnimals │  │ - approve     │     │   │
│  │  └──────────────┘  └──────────────┘  └───────────────┘     │   │
│  │                                                            │   │
│  │  ┌──────────────┐  ┌──────────────┐  ┌──────────────┐      │   │
│  │  │EmailService  │  │FileStorage   │  │Thingsboard   │      │   │
│  │  │ - send       │  │Service       │  │Service       │      │   │
│  │  │ - verify     │  │ - upload     │  │ - telemetry  │      │   │
│  │  │ - notify     │  │ - download   │  │ - animalData │      │   │
│  │  └──────────────┘  └──────────────┘  └──────────────┘      │   │
│  └───────────────────────┼────────────────────────────────────┘   │
│                          │                                        │
│  ┌───────────────────────┼────────────────────────────────────┐   │
│  │                    Repositories Layer                      │   │
│  │  ┌──────────────┐  ┌──────────────┐  ┌──────────────┐      │   │
│  │  │UserRepository│  │AnimalRepo    │  │RequestRepo   │      │   │
│  │  │ - JPA        │  │ - JPA        │  │ - JPA        │      │   │
│  │  │ - Queries    │  │ - Queries    │  │ - Queries    │      │   │
│  │  └──────────────┘  └──────────────┘  └──────────────┘      │   │
│  └───────────────────────┼────────────────────────────────────┘   │
│                          │                                        │
│  ┌───────────────────────┼────────────────────────────────────┐   │
│  │                    Configuration Layer                     │   │
│  │  ┌──────────────┐  ┌──────────────┐  ┌──────────────┐      │   │
│  │  │SecurityConfig│  │MinioConfig   │  │JwtUtil       │      │   │
│  │  │ - JWT Filter │  │ - Client     │  │ - Generate   │      │   │
│  │  │ - RBAC        │  │ - Bucket    │  │ - Validate   │      │   │
│  │  └──────────────┘  └──────────────┘  └──────────────┘      │   │
│  └────────────────────────────────────────────────────────────┘   │
└───────────────────────────────────────────────────────────────────┘
                          │
        ┌─────────────────┼─────────────────┐
        │                 │                 │
┌───────▼──────┐  ┌───────▼──────┐  ┌───────▼──────┐
│  PostgreSQL  │  │    MinIO     │  │  Keycloak    │
│  Database    │  │  Object Store│  │  Auth Server │
└──────────────┘  └──────────────┘  └──────────────┘
```

## 4. Class Diagram

### 4.1 Entity Classes

```
┌─────────────────────────────────────────────────────────────┐
│                         User                                │
├─────────────────────────────────────────────────────────────┤
│ - id: Integer                                               │
│ - username: String                                          │
│ - email: String                                             │
│ - password: String                                          │
│ - emailVerified: Boolean                                    │
│ - verificationToken: String                                 │
│ - verificationTokenExpiry: LocalDateTime                    │
│ - createdAt: LocalDateTime                                  │
│ - lastLogin: LocalDateTime                                  │
│ - roles: Set<Role>                                          │
├─────────────────────────────────────────────────────────────┤
│ + getId(): Integer                                          │
│ + getUsername(): String                                     │
│ + getEmail(): String                                        │
│ + getPassword(): String                                     │
│ + getRoles(): Set<Role>                                     │
│ + setEmailVerified(Boolean)                                 │
└─────────────────────────────────────────────────────────────┘
                            │
                            │ Many-to-Many
                            │
┌───────────────────────────▼─────────────────────────────────┐
│                         Role                                │
├─────────────────────────────────────────────────────────────┤
│ - id: Integer                                               │
│ - name: String (ADMIN, DOCTOR, CITIZEN, SHELTER)            │
├─────────────────────────────────────────────────────────────┤
│ + getId(): Integer                                          │
│ + getName(): String                                         │
└─────────────────────────────────────────────────────────────┘

┌─────────────────────────────────────────────────────────────┐
│                        Animal                               │
├─────────────────────────────────────────────────────────────┤
│ - id: Integer                                               │
│ - name: String                                              │
│ - type: String                                              │
│ - age: int                                                  │
│ - gender: Gender (MALE, FEMALE)                             │
│ - userId: Integer                                           │
│ - imageUrl: String                                          │
│ - req: int (request status)                                 │
├─────────────────────────────────────────────────────────────┤
│ + getId(): Integer                                          │
│ + getName(): String                                         │
│ + getType(): String                                         │
│ + getAge(): int                                             │
│ + getGender(): Gender                                       │
│ + getImageUrl(): String                                     │
│ + setReq(int)                                               │
└─────────────────────────────────────────────────────────────┘

┌─────────────────────────────────────────────────────────────┐
│                        Request                              │
├─────────────────────────────────────────────────────────────┤
│ - id: Integer                                               │
│ - name: String                                              │
│ - type: String                                              │
│ - age: int                                                  │
│ - gender: Gender                                            │
│ - userId: Integer                                           │
│ - imageUrl: String                                          │
│ - AdminApproved: int                                        │
│ - DocApproved: int                                          │
├─────────────────────────────────────────────────────────────┤
│ + getId(): Integer                                          │
│ + getName(): String                                         │
│ + getAdminApproved(): int                                   │
│ + getDocApproved(): int                                     │
│ + setAdminApproved(int)                                     │
│ + setDocApproved(int)                                       │
└─────────────────────────────────────────────────────────────┘
```

### 4.2 Service Classes

```
┌─────────────────────────────────────────────────────────────┐
│                      UserService                            │
├─────────────────────────────────────────────────────────────┤
│ - userRepository: UserRepository                            │
│ - roleRepository: RoleRepository                            │
│ - passwordEncoder: PasswordEncoder                          │
├─────────────────────────────────────────────────────────────┤
│ + saveUser(User): Integer                                   │
│ + getUser(Integer): User                                    │
│ + getUsers(): List<User>                                    │
│ + updateUser(User): void                                    │
│ + findByUsername(String): User                              │
│ + existsByUsername(String): Boolean                         │
│ + existsByEmail(String): Boolean                            │
│ + findByVerificationToken(String): User                     │
└─────────────────────────────────────────────────────────────┘
                            │ uses
                            │
┌───────────────────────────▼─────────────────────────────────┐
│                    UserRepository                           │
├─────────────────────────────────────────────────────────────┤
│ + findByUsername(String): Optional<User>                    │
│ + findByEmail(String): Optional<User>                       │
│ + existsByUsername(String): Boolean                         │
│ + existsByEmail(String): Boolean                            │
│ + findByVerificationToken(String): Optional<User>           │
└─────────────────────────────────────────────────────────────┘

┌─────────────────────────────────────────────────────────────┐
│                     AnimalService                           │
├─────────────────────────────────────────────────────────────┤
│ - animalRepository: AnimalRepository                        │
├─────────────────────────────────────────────────────────────┤
│ + saveAnimal(Animal): Animal                                │
│ + getAnimal(Integer): Animal                                │
│ + getAnimals(): List<Animal>                                │
│ + Delanimal(Animal): void                                   │
└─────────────────────────────────────────────────────────────┘
                            │ uses
                            │
┌───────────────────────────▼─────────────────────────────────┐
│                   AnimalRepository                          │
├─────────────────────────────────────────────────────────────┤
│ + findAll(): List<Animal>                                   │
│ + findById(Integer): Optional<Animal>                       │
│ + save(Animal): Animal                                      │
│ + delete(Animal): void                                      │
└─────────────────────────────────────────────────────────────┘

┌──────────────────────────────────────────────────────────────┐
│                    EmailService                              │
├──────────────────────────────────────────────────────────────┤
│ - mailSender: JavaMailSender                                 │
│ - fileStorageService: FileStorageService                     │
│ - frontendUrl: String                                        │
├──────────────────────────────────────────────────────────────┤
│ + send(String, String, String): void                         │
│ + sendVerificationEmail(String, String, String): void        │
│ + sendWelcomeEmail(String, String): void                     │
│ + sendLoginNotification(String, String, String, String): void│
│ + sendRequestSubmittedEmail(String, String, String): void    │
│ + sendNewAnimalNotification(...): void                       │
└──────────────────────────────────────────────────────────────┘

┌─────────────────────────────────────────────────────────────┐
│                  FileStorageService                         │
├─────────────────────────────────────────────────────────────┤
│ - minioClient: MinioClient                                  │
│ - minioConfig: MinioConfig                                  │
├─────────────────────────────────────────────────────────────┤
│ + uploadImage(MultipartFile): String                        │
│ + generatePublicUrl(String): String                         │
│ + deleteImage(String): void                                 │
│ + imageExists(String): Boolean                              │
│ + getImageInputStream(String): InputStream                  │
└─────────────────────────────────────────────────────────────┘

┌─────────────────────────────────────────────────────────────┐
│                  ThingsboardService                         │
├─────────────────────────────────────────────────────────────┤
│ - thingsboardUrl: String                                    │
│ - accessToken: String                                       │
│ - restTemplate: RestTemplate                                │
├─────────────────────────────────────────────────────────────┤
│ + sendTelemetry(): void (@Scheduled)                        │
│ + sendAnimalData(String, String, int, String, Integer): void│
└─────────────────────────────────────────────────────────────┘
```

### 4.3 Controller Classes

```
┌─────────────────────────────────────────────────────────────┐
│                     AuthController                          │
├─────────────────────────────────────────────────────────────┤
│ - userService: UserService                                  │
│ - jwtUtil: JwtUtil                                          │
│ - authenticationManager: AuthenticationManager              │
│ - emailService: EmailService                                │
├─────────────────────────────────────────────────────────────┤
│ + register(Map<String, String>): ResponseEntity             │
│ + login(Map<String, String>): ResponseEntity                │
│ + verifyEmail(String): ResponseEntity                       │
└─────────────────────────────────────────────────────────────┘

┌─────────────────────────────────────────────────────────────┐
│                    AnimalController                         │
├─────────────────────────────────────────────────────────────┤
│ - animalService: AnimalService                              │
│ - requestRepository: RequestRepository                      │
│ - emailService: EmailService                                │
│ - userService: UserService                                  │
│ - requestService: RequestService                            │
│ - thingsboardService: ThingsboardService                    │
├─────────────────────────────────────────────────────────────┤
│ + showAnimals(): List<Animal>                               │
│ + showAnimal(Integer): Animal                               │
│ + createAnimal(Animal): Animal                              │
│ + updateAnimal(Integer, Animal): Animal                     │
│ + deleteAnimal(Integer): ResponseEntity                     │
│ + requestAnimal(Integer): ResponseEntity                    │
│ + acceptAdoption(Integer): ResponseEntity                   │
└─────────────────────────────────────────────────────────────┘

┌─────────────────────────────────────────────────────────────┐
│                    RequestController                        │
├─────────────────────────────────────────────────────────────┤
│ - requestService: RequestService                            │
│ - animalService: AnimalService                              │
│ - emailService: EmailService                                │
│ - userService: UserService                                  │
├─────────────────────────────────────────────────────────────┤
│ + showRequests(): List<Request>                             │
│ + showRequest(Integer): Request                             │
│ + approveDoctor(Integer): ResponseEntity                    │
│ + approveAdmin(Integer): ResponseEntity                     │
│ + rejectRequest(Integer): ResponseEntity                    │
└─────────────────────────────────────────────────────────────┘
```

## 5. Database Schema

### 5.1 Entity Relationship Diagram

```
┌───────────────┐        ┌──────────────┐         ┌──────────────┐
│    Users      │        │  User_Roles  │         │    Roles     │
├───────────────┤        ├──────────────┤         ├──────────────┤
│ id (PK)       │◄─┐     │ user_id (FK) │     ┌──►│ id (PK)      │
│ username      │  │     │ role_id (FK) │     │   │ name         │
│ email         │  │     └──────────────┘     │   └──────────────┘
│ password      │  │                          │
│ email_verified│  │                          │
│ verification_ │  │                          │
│   token       │  │                          │
│ created_at    │  │                          │
│ last_login    │  │                          │
└───────────────┘  │                          │
                   │                          │
                   │                          │ 
┌──────────────┐   │                          │
│   Animals    │   │                          │
├──────────────┤   │                          │
│ id (PK)      │   │                          │
│ name         │   │                          │
│ type         │   │                          │
│ age          │   │                          │
│ gender       │   │                          │
│ user_id (FK) │───┘                          │
│ image_url    │                              │
│ req          │                              │
└──────────────┘                              │
                                              │
┌───────────────┐                             │
│   Requests    │                             │
├───────────────┤                             │
│ id (PK)       │                             │
│ name          │                             │
│ type          │                             │
│ age           │                             │ 
│ gender        │                             │
│ user_id (FK)  │─────────────────────────────┘
│ image_url     │
│ admin_approved│
│ doc_approved  │
└───────────────┘
```

### 5.2 Table Definitions

#### Users Table
```sql
CREATE TABLE users (
    id SERIAL PRIMARY KEY,
    username VARCHAR(20) UNIQUE NOT NULL,
    email VARCHAR(50) UNIQUE NOT NULL,
    password VARCHAR(120) NOT NULL,
    email_verified BOOLEAN DEFAULT FALSE,
    verification_token VARCHAR(255),
    verification_token_expiry TIMESTAMP,
    created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
    last_login TIMESTAMP
);
```

#### Roles Table
```sql
CREATE TABLE roles (
    id SERIAL PRIMARY KEY,
    name VARCHAR(20) UNIQUE NOT NULL
);
```

#### User_Roles Table (Many-to-Many)
```sql
CREATE TABLE user_roles (
    user_id INTEGER REFERENCES users(id),
    role_id INTEGER REFERENCES roles(id),
    PRIMARY KEY (user_id, role_id)
);
```

#### Animals Table
```sql
CREATE TABLE animals (
    id SERIAL PRIMARY KEY,
    name VARCHAR(255),
    type VARCHAR(255),
    age INTEGER,
    gender VARCHAR(10),
    user_id INTEGER REFERENCES users(id),
    image_url TEXT,
    req INTEGER DEFAULT 0
);
```

#### Requests Table
```sql
CREATE TABLE requests (
    id SERIAL PRIMARY KEY,
    name VARCHAR(255),
    type VARCHAR(255),
    age INTEGER,
    gender VARCHAR(10),
    user_id INTEGER REFERENCES users(id),
    image_url TEXT,
    admin_approved INTEGER DEFAULT 0,
    doc_approved INTEGER DEFAULT 0
);
```

## 6. Sequence Diagrams

### 6.1 User Registration Sequence

```
User          Frontend        Backend         EmailService    PostgreSQL
  │               │               │                 │              │
  │──Register─────▶              │                 │              │
  │               │               │                 │              │
  │               │──POST /register───────────────▶│              │
  │               │               │                 │              │
  │               │               │──saveUser()─────┼─────────────▶│
  │               │               │◄────────────────┼──────────────│
  │               │               │                 │              │
  │               │               │──sendVerificationEmail()──────▶│
  │               │               │                 │──SMTP───────▶│
  │               │               │                 │              │
  │               │◄──200 OK──────│                 │              │
  │◄──Success─────│               │                 │              │
  │               │               │                 │              │
  │──Click Link───▶               │                 │              │
  │               │──GET /verify?token─────────────▶│              │
  │               │               │──verifyToken()──┼─────────────▶│
  │               │               │◄────────────────┼──────────────│
  │               │               │──sendWelcomeEmail()───────────▶│
  │               │◄──200 OK──────│                 │              │
  │◄──Verified────│               │                 │              │
```

### 6.2 Animal Upload Sequence

```
Shelter       Frontend        Backend         MinIO          EmailService  ThingsBoard
  │               │               │               │                 │              │
  │──Upload───────▶              │               │                 │              │
  │               │               │               │                 │              │
  │               │──POST /animals (multipart)───▶│                │              │
  │               │               │               │                 │              │
  │               │               │──uploadImage()─────────────────▶│              │
  │               │               │◄──────────────URL───────────────│              │
  │               │               │               │                 │               │
  │               │               │──saveAnimal()───────────────────┼─────────────▶│
  │               │               │               │                 │               │
  │               │               │──sendNewAnimalNotification()────▶│             │
  │               │               │               │                 │               │
  │               │               │──sendAnimalData()───────────────┼─────────────▶│
  │               │               │               │                 │               │
  │               │◄──200 OK──────│               │                 │               │
  │◄──Success─────│               │               │                 │               │
```

### 6.3 Request Approval Sequence

```
Citizen       Frontend        Backend         EmailService    PostgreSQL
  │               │               │                 │              │
  │──Request──────▶               │                 │              │
  │               │──PUT /animals/Request/{id}────▶│              │
  │               │               │                 │              │
  │               │               │──createRequest()───────────────▶│
  │               │               │◄────────────────────────────────│
  │               │               │                 │              │
  │               │               │──sendRequestSubmittedEmail()───▶│
  │               │◄──200 OK──────│                 │              │
  │               │               │                 │              │
  │               │               │                 │              │
Doctor        Frontend        Backend         EmailService    PostgreSQL
  │               │               │                 │              │
  │──Approve──────▶               │                 │              │
  │               │──PUT /requests/{id}/approve-doctor─────────────▶│
  │               │               │                 │              │
  │               │               │──updateRequest()────────────────▶│
  │               │               │◄────────────────────────────────│
  │               │◄──200 OK──────│                 │              │
  │               │               │                 │              │
Admin         Frontend        Backend         EmailService    PostgreSQL
  │               │               │                 │              │
  │──Approve──────▶               │                 │              │
  │               │──PUT /requests/{id}/approve-admin─────────────▶│
  │               │               │                 │              │
  │               │               │──convertToAnimal()─────────────▶│
  │               │               │──sendRequestApprovedEmail()─────▶│
  │               │◄──200 OK──────│                 │              │
```

## 7. Deployment Architecture

### 7.1 Docker Compose Architecture

```
┌─────────────────────────────────────────────────────────────┐
│                    Docker Network                           │
│              (devops-pets-network)                          │
│                                                             │
│  ┌──────────┐  ┌──────────┐  ┌──────────┐  ┌──────────┐     │
│  │ Frontend │  │ Backend  │  │ Keycloak │  │ MinIO    │     │
│  │ :8083    │  │ :8080    │  │ :8081    │  │ :9000    │     │
│  └──────────┘  └──────────┘  └──────────┘  └──────────┘     │
│                                                             │
│  ┌──────────┐  ┌──────────┐  ┌──────────┐  ┌──────────┐     │
│  │PostgreSQL│  │ RabbitMQ │  │ThingsBoard│ │ Node-RED │     │
│  │ :5432    │  │ :5672    │  │ :9090    │  │ :1880    │     │
│  └──────────┘  └──────────┘  └──────────┘  └──────────┘     │
│                                                             │
│  ┌──────────┐                                               │
│  │ MailHog  │                                               │
│  │ :8025    │                                               │
│  └──────────┘                                               │
└─────────────────────────────────────────────────────────────┘
```

### 7.2 Kubernetes Architecture

```
┌─────────────────────────────────────────────────────────────┐
│                    Kubernetes Cluster                       │
│                  (Namespace: devops-pets)                   │
│                                                             │
│  ┌──────────────────────────────────────────────────────┐   │
│  │                  Ingress Controller                  │   │
│  │              (Nginx Ingress)                         │   │
│  └──────────────────────────────────────────────────────┘   │
│                          │                                  │
│        ┌─────────────────┼─────────────────┐                │
│        │                 │                 │                │
│  ┌─────▼──────┐   ┌──────▼──────┐   ┌──────▼─────┐          │
│  │  Frontend  │   │   Backend   │   │  Keycloak  │          │
│  │  Service   │   │   Service   │   │  Service   │          │
│  │  :80       │   │  :8080      │   │  :8080     │          │
│  └────────────┘   └─────────────┘   └────────────┘          │
│        │                 │                 │                │
│  ┌─────▼──────┐   ┌──────▼──────┐   ┌──────▼──────┐         │
│  │  Frontend  │   │   Backend   │   │  Keycloak  │          │
│  │ Deployment │   │ Deployment  │   │ Deployment │          │
│  │ (Replicas) │   │ (Replicas)  │   │            │          │
│  └────────────┘   └─────────────┘   └────────────┘          │
│                                                             │
│  ┌──────────────┐  ┌──────────────┐  ┌──────────────┐       │
│  │  PostgreSQL  │  │    MinIO     │  │  RabbitMQ    │       │
│  │  StatefulSet │  │  StatefulSet │  │  StatefulSet │       │
│  │  + PVC       │  │  + PVC       │  │  + PVC       │       │
│  └──────────────┘  └──────────────┘  └──────────────┘       │
│                                                             │
│  ┌──────────────┐  ┌──────────────┐                         │
│  │ ThingsBoard  │  │  Node-RED    │                         │
│  │  Deployment  │  │  Deployment  │                         │
│  └──────────────┘  └──────────────┘                         │
└─────────────────────────────────────────────────────────────┘
```

## 8. Security Architecture

### 8.1 Authentication Flow

```
┌──────────┐        ┌──────────┐         ┌──────────┐         ┌──────────┐
│  Client  │        │ Frontend │         │ Backend  │         │ Keycloak │
└────┬─────┘        └────┬─────┘         └────┬─────┘         └────┬─────┘
     │                   │                    │                    │
     │──Login Request───▶│                    │                    │
     │                   │──POST /auth/login──▶│                   │
     │                   │                    │                    │
     │                   │                    │──OAuth2 Request───▶│
     │                   │                    │◄──JWT Token────────│
     │                   │                    │                    │
     │                   │◄──JWT Token────────│                    │
     │◄──JWT Token───────│                    │                    │
     │                   │                    │                    │
     │──API Request──────▶│                    │                   │
     │  (with JWT)       │──Request + JWT────▶│                    │
     │                   │                    │                    │
     │                   │                    │──Validate JWT─────▶│
     │                   │                    │◄──Valid───────────│
     │                   │                    │                     │
     │                   │◄──Response─────────│                    │
     │◄──Response────────│                    │                    │
```

### 8.2 Authorization Model

```
┌───────────────────────────────────────────────────────────┐
│                    Role-Based Access Control              │
│                                                           │
│  ┌──────────────┐  ┌──────────────┐  ┌──────────────┐     │
│  │    ADMIN     │  │    DOCTOR    │  │   CITIZEN    │     │
│  │              │  │              │  │              │     │
│  │ - All ops    │  │ - View       │  │ - View       │     │
│  │ - Approve    │  │ - Approve    │  │ - Request    │     │
│  │ - Delete     │  │   Requests   │  │   Adoption   │     │
│  │ - Manage     │  │              │  │              │     │
│  │   Users      │  │              │  │              │     │
│  └──────────────┘  └──────────────┘  └──────────────┘     │
│                                                           │
│  ┌──────────────┐                                         │
│  │   SHELTER    │                                         │
│  │              │                                         │
│  │ - Add        │                                         │
│  │   Animals    │                                         │
│  │ - Manage     │                                         │
│  │   Animals    │                                         │
│  └──────────────┘                                         │
└───────────────────────────────────────────────────────────┘
```

## 9. Data Flow Architecture

### 9.1 Request Flow

```
┌─────────────────────────────────────────────────────────────┐
│                    Request Processing Flow                  │
│                                                             │
│  Client Request                                             │
│      │                                                      │
│      ▼                                                      │
│  ┌──────────┐                                               │
│  │ Frontend │                                               │
│  │  (Vue)   │                                               │
│  └────┬─────┘                                               │
│       │                                                     │
│       │ HTTP/REST                                           │
│       ▼                                                     │
│  ┌──────────┐                                               │
│  │ Backend  │                                               │
│  │ (Spring) │                                               │
│  └────┬─────┘                                               │
│       │                                                     │
│       ├─────────────────┬─────────────────┐                 │
│       │                 │                 │                 │
│       ▼                 ▼                 ▼                 │
│  ┌──────────┐    ┌──────────┐    ┌──────────┐               │
│  │PostgreSQL│    │   MinIO  │    │ Keycloak │               │
│  │ Database │    │  Storage  │    │   Auth   │              │
│  └──────────┘    └──────────┘    └──────────┘               │
│                                                             │
│       │                                                     │
│       ├─────────────────┬─────────────────┐                 │
│       │                 │                 │                 │
│       ▼                 ▼                 ▼                 │
│  ┌──────────┐    ┌──────────┐    ┌──────────┐               │
│  │   Email  │    │RabbitMQ  │    │ThingsBoard│              │
│  │  Service │    │  Queue   │    │   IoT     │              │
│  └──────────┘    └──────────┘    └──────────┘               │
│                                                             │
│       │                                                     │
│       ▼                                                     │
│  Response to Client                                         │
└─────────────────────────────────────────────────────────────┘
```

## 10. Technology Stack Summary

### 10.1 Frontend Stack
- **Framework**: Vue.js 3
- **Build Tool**: Vite
- **State Management**: Pinia
- **Routing**: Vue Router
- **HTTP Client**: Axios
- **Container**: Nginx

### 10.2 Backend Stack
- **Framework**: Spring Boot 3.3.8
- **Language**: Java 17
- **Security**: Spring Security, JWT
- **ORM**: Spring Data JPA / Hibernate
- **Database**: PostgreSQL
- **Object Storage**: MinIO SDK
- **Email**: Spring Mail (SMTP)
- **Messaging**: Spring AMQP (RabbitMQ)

### 10.3 Infrastructure Stack
- **Containerization**: Docker
- **Orchestration**: Kubernetes
- **Identity Provider**: Keycloak
- **Message Broker**: RabbitMQ
- **IoT Platform**: ThingsBoard
- **Automation**: Node-RED
- **Email Testing**: MailHog

### 10.4 DevOps Stack
- **CI/CD**: Jenkins
- **Version Control**: Git
- **Build Tool**: Maven (Backend), npm (Frontend)

## 11. Scalability Considerations

### 11.1 Horizontal Scaling
- **Frontend**: Stateless, can scale horizontally
- **Backend**: Stateless API, can scale horizontally
- **Database**: Read replicas for read-heavy workloads
- **MinIO**: Distributed mode for large-scale storage

### 11.2 Vertical Scaling
- **Database**: Increase resources for larger datasets
- **Message Queue**: Increase memory for high-throughput scenarios

### 11.3 Caching Strategy
- **Frontend**: Browser caching for static assets
- **Backend**: Redis for session management (future)
- **Database**: Query result caching (future)

## 12. Monitoring and Observability

### 12.1 Logging
- **Application Logs**: Spring Boot logging
- **Container Logs**: Docker/Kubernetes logs
- **Access Logs**: Nginx access logs

### 12.2 Metrics (Future)
- **Application Metrics**: Spring Actuator
- **Infrastructure Metrics**: Prometheus
- **Visualization**: Grafana

### 12.3 Health Checks
- **Application Health**: `/actuator/health`
- **Container Health**: Docker health checks
- **Kubernetes**: Liveness and readiness probes

## 13. Backup and Recovery

### 13.1 Database Backups
- **PostgreSQL**: Periodic dumps
- **MinIO**: Object replication
- **Keycloak**: Realm exports

### 13.2 Disaster Recovery
- **Backup Strategy**: Daily backups
- **Recovery Time Objective (RTO)**: < 4 hours
- **Recovery Point Objective (RPO)**: < 24 hours

## 14. Συμπεράσματα

Η αρχιτεκτονική του Pet Adoption System είναι σχεδιασμένη για:
- **Scalability**: Μπορεί να κλιμακωθεί οριζόντια και κάθετα
- **Reliability**: High availability με health checks και monitoring
- **Security**: Multi-layer security με authentication και authorization
- **Maintainability**: Modular design με clear separation of concerns
- **Extensibility**: Εύκολη προσθήκη νέων features και services




